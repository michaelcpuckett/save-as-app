<!DOCTYPE html>
<title>save-as.app</title>
<meta
  name="viewport"
  content="width=device-width, initial-scale=1, viewport-fit=cover"
/>
<meta
  name="description"
  content="Open any website in a standalone window on iPhone or iPad, instead of Safari."
/>
<meta name="mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<link rel="manifest" href="/manifest.json" />

<style>
  :root {
    color-scheme: dark;
    height: 100%;
    font-size: 24px;
  }
  body {
    font-family: sans-serif;
    display: grid;
    line-height: 1.4;
    place-items: center;
    place-content: center;
    height: max-content;
    min-height: 100%;
    margin: 0;
  }
  a {
    color: deepskyblue;
  }
  h1 {
    font-size: 1rem;
  }
  form {
    position: relative;
    box-sizing: border-box;
    padding: 1rem;
    padding-top: calc(1rem + 18px);
    display: grid;
    gap: 1rem;
    width: min(100% - 2rem, 20rem);
    border: 0.1rem solid #4c4b4b;
    border-radius: 2rem;
    margin: 2rem auto;
    overflow: hidden;
  }
  @media (min-width: 600px) {
    form {
      padding: 2rem;
      padding-top: calc(2rem + 18px);
    }
  }
  form:before {
    position: absolute;
    content: "";
    left: 0;
    right: 0;
    height: 18px;
    background: #4c4b4b;
  }
  form:after {
    position: absolute;
    content: "";
    left: 0;
    right: 0;
    top: 4px;
    height: 8px;
    background: url("handle-buttons.svg");
    background-repeat: no-repeat;
    background-position: center center;
  }
  h2 {
    margin: 0;
    font-size: 1rem;
  }
  input {
    font-size: 0.75rem;
    border: 0.1rem solid #4c4b4b;
    width: 100%;
    display: block;
    padding: 0.5rem;
    border-radius: 0.5rem;
    box-sizing: border-box;
  }
  input[type="file"] {
    align-items: center;
    justify-content: center;
    display: flex;
  }
  label {
    font-size: 0.75rem;
    font-weight: bold;
    display: grid;
    width: 100%;
    gap: 0.25rem;
  }
  p {
    font-size: 0.75rem;
  }
  button {
    font: unset;
    font-size: 1rem;
    padding: 0.5rem;
    border: 0.1rem solid #4c4b4b;
    border-radius: 0.5rem;
    cursor: pointer;
    font-weight: bold;
    color: Canvas;
    background: deepskyblue;
  }
  footer {
    width: min(100% - 2rem, 20rem);
    margin-bottom: 2rem;
  }
  .instructions {
    margin-top: 50vh;
    margin-top: 50dvh;
    margin-bottom: 50vh;
    margin-bottom: 50dvh;
  }
</style>
<body>
  <script>
    if (window.location.href.includes("?url=")) {
      const metaRefreshEl = window.document.createElement("meta");
      metaRefreshEl.setAttribute("http-equiv", "refresh");
      metaRefreshEl.setAttribute(
        "content",
        `0;url=${window.location.href.split("?url=")[1]}`
      );
      window.document.head.append(metaRefreshEl);
    } else {
      const formEl = window.document.createElement("form");
      const linkEl = window.document.createElement("link");
      linkEl.setAttribute("rel", "apple-touch-icon");
      const nameInputEl = window.document.createElement("input");
      nameInputEl.setAttribute("placeholder", "My Web App");
      nameInputEl.setAttribute("type", "text");
      nameInputEl.setAttribute("required", "");
      const fileInputEl = window.document.createElement("input");
      fileInputEl.setAttribute("type", "file");
      fileInputEl.addEventListener("change", (e) => {
        const file = fileInputEl.files[0];
        const reader = new FileReader();

        reader.addEventListener("load", () => {
          // convert image file to base64 string
          linkEl.href = reader.result;
        });

        if (file) {
          reader.readAsDataURL(file);
        }
      });
      const urlInputEl = window.document.createElement("input");
      urlInputEl.setAttribute("placeholder", "https://...");
      urlInputEl.setAttribute("type", "url");
      urlInputEl.setAttribute("required", "");
      const h1El = window.document.createElement("h1");
      const h1AnchorEl = window.document.createElement("a");
      h1AnchorEl.innerText = `save-as.app`;
      h1AnchorEl.setAttribute("href", window.location.href);
      h1El.append(h1AnchorEl);
      formEl.append(h1El);
      const h2El = window.document.createElement("h2");
      h2El.innerText = `Open any website in a standalone window on iPhone or iPad, instead of Safari.`;
      formEl.append(h2El);
      const nameInputLabel = window.document.createElement("label");
      nameInputLabel.innerText = "Title*";
      nameInputLabel.append(nameInputEl);
      const fileInputLabel = window.document.createElement("label");
      fileInputLabel.innerText = "Icon";
      fileInputLabel.append(fileInputEl);
      const urlInputLabel = window.document.createElement("label");
      urlInputLabel.innerText = "URL*";
      urlInputLabel.append(urlInputEl);
      formEl.append(nameInputLabel);
      formEl.append(fileInputLabel);
      formEl.append(urlInputLabel);
      const buttonEl = window.document.createElement("button");
      buttonEl.innerText = "Next";
      formEl.append(buttonEl);
      const paragraphEl = window.document.createElement("p");
      paragraphEl.textContent =
        'On the next screen, hit the share icon, then select "Add to Home Screen" from the share sheet.';
      formEl.append(paragraphEl);
      formEl.addEventListener("submit", (event) => {
        event.preventDefault();
        if (urlInputEl.value) {
          if (linkEl.href) {
            window.document.head.append(linkEl);
          }
          if (nameInputEl.value) {
            window.document.title = nameInputEl.value;
          }
          formEl.remove();
          const h1El = window.document.createElement("h1");
          h1El.innerText = "Add to Home Screen";
          h1El.classList.add("instructions");
          window.document.body.prepend(h1El);
          window.history.pushState({}, "", `/?url=${urlInputEl.value}`);
          const manifestLinkEl = window.document.createElement("link");
          manifestLinkEl.setAttribute("rel", "manifest");
          const manifestDataUri = `data:application/manifest+json;charset=utf-8,${encodeURIComponent(
            JSON.stringify({
              name: window.document.title,
              short_name: window.document.title,
              start_url: window.location.href,
              display: "standalone",
              background_color: "#000000",
              theme_color: "#000000",
            })
          )}`;
          manifestLinkEl.setAttribute("href", manifestDataUri);
          window.document.head.append(manifestLinkEl);
        }
      });
      window.document.body.append(formEl);
    }
  </script>
  <footer>
    <h2>How does this work?</h2>
    <p>
      Web browsers look for a `manifest.json` file to determine whether a
      website is a Progressive Web App. This file contains metadata about the
      app, including its name, icon, and URL. This website generates a
      `manifest.json` file, configured to launch as a standalone app that opens
      in a separate window on iPhone and iPad.
    </p>
    <p>
      This website is open source. You can view the source code on
      <a href="https://www.github.com/michaelcpuckett/standalone-web-wrapper"
        >Github</a
      >.
    </p>
  </footer>
</body>
