<!DOCTYPE html>
<link rel="manifest" href="/manifest.json" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1. viewport-fit=cover"
/>
<meta name="mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<body>
  <script>
    if (window.location.href.includes("?url=")) {
      const metaRefreshEl = window.document.createElement("meta");
      metaRefreshEl.setAttribute("http-equiv", "refresh");
      metaRefreshEl.setAttribute(
        "content",
        `0;url=${window.location.href.split("?url=")[1]}`
      );
      window.document.head.append(metaRefreshEl);
    } else {
      const formEl = window.document.createElement("form");
      const linkEl = window.document.createElement("link");
      linkEl.setAttribute("rel", "apple-touch-icon");
      const nameInputEl = window.document.createElement("input");
      nameInputEl.setAttribute("placeholder", "Name");
      nameInputEl.setAttribute("type", "text");
      const fileInputEl = window.document.createElement("input");
      fileInputEl.setAttribute("type", "file");
      fileInputEl.addEventListener("change", (e) => {
        const file = fileInputEl.files[0];
        const reader = new FileReader();

        reader.addEventListener("load", () => {
          // convert image file to base64 string
          linkEl.href = reader.result;
        });

        if (file) {
          reader.readAsDataURL(file);
        }
      });
      const urlInputEl = window.document.createElement("input");
      urlInputEl.setAttribute("placeholder", "URL");
      urlInputEl.setAttribute("type", "url");
      const h1El = window.document.createElement("h1");
      h1El.innerText = `save-as.app`;
      formEl.append(h1El);
      const h2El = window.document.createElement("h2");
      h2El.innerText = `Open any website in a standalone window on iPhone or iPad.`;
      formEl.append(h2El);
      const nameInputLabel = window.document.createElement("label");
      nameInputLabel.innerText = "Name";
      nameInputLabel.append(nameInputEl);
      const fileInputLabel = window.document.createElement("label");
      fileInputLabel.innerText = "Icon";
      fileInputLabel.append(fileInputEl);
      const urlInputLabel = window.document.createElement("label");
      urlInputLabel.innerText = "URL";
      urlInputLabel.append(urlInputEl);
      formEl.append(nameInputLabel);
      formEl.append(fileInputLabel);
      formEl.append(urlInputLabel);
      const buttonEl = window.document.createElement("button");
      buttonEl.innerText = "Submit";
      formEl.append(buttonEl);
      formEl.addEventListener("submit", (event) => {
        event.preventDefault();
        if (urlInputEl.value) {
          if (linkEl.href) {
            window.document.head.append(linkEl);
          }
          if (nameInputEl.value) {
            window.document.title = nameInputEl.value;
          }
          formEl.remove();
          const h1El = window.document.createElement("h1");
          h1El.innerText = "Add to Home Screen";
          window.document.body.append(h1El);
          window.history.pushState({}, "", `/?url=${urlInputEl.value}`);
          const manifestLinkEl = window.document.createElement("link");
          manifestLinkEl.setAttribute("rel", "manifest");
          const manifestDataUri = `data:application/manifest+json;charset=utf-8,${encodeURIComponent(
            JSON.stringify({
              name: window.document.title,
              short_name: window.document.title,
              start_url: window.location.href,
              display: "standalone",
              background_color: "#000000",
              theme_color: "#000000",
            })
          )}`;
          manifestLinkEl.setAttribute("href", manifestDataUri);
          window.document.head.append(manifestLinkEl);
        }
      });
      window.document.body.append(formEl);
    }
  </script>
  <style>
    body {
      font-family: sans-serif;
      display: flex;
      place-items: center;
      place-content: center;
      height: 100dvh;
      margin: 0;
    }
    h1 {
      color: rgb(66, 47, 175);
    }
    h1 {
      font-size: 24px;
    }
    form {
      box-sizing: border-box;
      padding: 48px;
      display: grid;
      gap: 12px;
    }
    input {
      font-size: 22px;
      border: 1px solid currentColor;
    }
    input {
      width: 100%;
      display: block;
      padding: 8px;
      border-radius: 8px;
      box-sizing: border-box;
    }
    input[type="file"] {
      align-items: center;
      justify-content: center;
      display: flex;
    }
    input[type="color"],
    input[type="radio"] {
      height: 48px;
      width: 48px;
    }
    label {
      display: grid;
      width: 100%;
    }
    button {
      background: deepskyblue;
      color: black;
      font: unset;
      font-size: 22px;
      padding: 5px 11px;
      border: 4px solid lightskyblue;
      border-radius: 12px;
      cursor: pointer;
    }
    button:hover {
      background: lightskyblue;
    }
  </style>
</body>
